<%= form_with model: [:admin, @product], local: true do |f| %>
  <%= form_errors_for(@product) %>

  <!-- Basic fields -->
  <div class="mb-3">
    <%= f.label :name, class: "form-label" %>
    <%= f.text_field :name, class: "form-control", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :description, class: "form-label" %>
    <%= f.text_area :description, rows: 5, class: "form-control" %>
  </div>

  <div class="row">
    <div class="col-md-4 mb-3">
      <%= f.label :price, class: "form-label" %>
      <%= f.number_field :price, step: 0.01, min: 0, class: "form-control", required: true %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :stock_quantity, class: "form-label" %>
      <%= f.number_field :stock_quantity, step: 1, min: 0, class: "form-control", required: true %>
    </div>
    <div class="col-md-4 mb-3">
      <%= f.label :category_id, "Category", class: "form-label" %>
      <%= f.collection_select :category_id, Category.order(:name), :id, :name,
                              { include_blank: "Select a category" },
                              { class: "form-select" } %>
    </div>
  </div>

  <!-- Flags -->
  <fieldset class="row mb-3">
    <legend class="col-form-label col-12">Flags</legend>
    <div class="col-md-4 form-check">
      <%= f.check_box :on_sale, class: "form-check-input" %>
      <%= f.label :on_sale, class: "form-check-label" %>
    </div>
    <!-- Remove is_new and recently_updated unless backed by DB columns -->
  </fieldset>

  <!-- Primary image -->
  <div class="mb-3">
    <%= f.label :image, "Primary Image", class: "form-label" %>
    <%= f.file_field :image, class: "form-control", accept: "image/*" %>
    <% if @product.image.attached? %>
      <div class="mt-2">
        <%= image_tag @product.image.variant(resize_to_limit: [200, 200]),
                      class: "img-thumbnail",
                      alt: "Primary image of #{@product.name}" %>
        <%= button_to "Remove primary image",
                      purge_image_admin_product_path(@product),
                      method: :delete,
                      class: "btn btn-sm btn-outline-danger mt-2",
                      data: { turbo_confirm: "Remove the primary image?" } %>
      </div>
    <% end %>
  </div>

  <!-- Gallery images -->
  <div class="mb-3">
    <%= f.label :images, "Gallery Images", class: "form-label" %>
    <%= f.file_field :images, multiple: true, class: "form-control", accept: "image/*" %>
    <% if @product.images.attached? %>
      <div class="mt-2 row">
        <% @product.images.each do |img| %>
          <div class="col-auto text-center">
            <%= image_tag img.variant(resize_to_limit: [120, 120]),
                          class: "img-thumbnail mb-1",
                          alt: "#{@product.name} gallery image" %>
            <%= button_to "Remove",
                          purge_gallery_image_admin_product_path(@product, img.id),
                          method: :delete,
                          class: "btn btn-sm btn-outline-danger",
                          data: { turbo_confirm: "Remove this gallery image?" } %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Actions -->
  <div class="mt-3">
    <%= f.submit "Save Product", class: "btn btn-primary" %>
    <%= link_to "Cancel", admin_products_path, class: "btn btn-secondary ms-2" %>
  </div>
<% end %>
